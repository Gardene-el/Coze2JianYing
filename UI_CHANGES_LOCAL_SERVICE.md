# UI 变更说明 - 本地服务标签页

## 概述

本文档说明了新增"本地服务"标签页后的 UI 变更。由于无法在无头环境中生成实际截图，此处提供详细的文字描述和 ASCII 艺术图。

## 标签页布局变更

### 之前的标签页布局

```
┌────────────────────────────────────────────────────────────────┐
│ Coze剪映草稿生成器                                   ╳         │
├────────────────────────────────────────────────────────────────┤
│ 文件(F) 查看(V) 帮助(H)                                        │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌────────────┬─────────────┐                                 │
│  │ 草稿生成   │ 示例标签页   │                                 │
│  └────────────┴─────────────┘                                 │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                                                          │ │
│  │  [草稿生成标签页内容]                                     │ │
│  │                                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│ 日志 ▼                                                         │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ [日志内容显示区域]                                        │ │
│ └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│ 状态栏: 就绪                                                   │
└────────────────────────────────────────────────────────────────┘
```

### 之后的标签页布局

```
┌────────────────────────────────────────────────────────────────┐
│ Coze剪映草稿生成器                                   ╳         │
├────────────────────────────────────────────────────────────────┤
│ 文件(F) 查看(V) 帮助(H)                                        │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌────────────┬────────────┬─────────────┐                    │
│  │手动草稿生成│ 本地服务   │ 示例标签页   │  ← 新增标签      │
│  └────────────┴────────────┴─────────────┘                    │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │                                                          │ │
│  │  [当前选中标签页的内容]                                   │ │
│  │                                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│ 日志 ▼                                                         │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ [日志内容显示区域]                                        │ │
│ └──────────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────────┤
│ 状态栏: 就绪                                                   │
└────────────────────────────────────────────────────────────────┘
```

## 标签页详细内容

### 1. 手动草稿生成标签页（重命名）

**变更**: 标签名称从"草稿生成"改为"手动草稿生成"

```
┌──────────────────────────────────────────────────────────────┐
│ 输出设置 ──────────────────────────────────────────────────── │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 剪映草稿文件夹: [未选择（将使用默认路径）            ]    │ │
│ │                 [选择文件夹...] [自动检测]               │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ 输入内容:                                                    │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │                                                          │ │
│ │  [文本输入区域]                                          │ │
│ │                                                          │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ [生成草稿] [生成元信息] [清空]                               │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ 状态栏: 就绪                                                 │
└──────────────────────────────────────────────────────────────┘
```

### 2. 本地服务标签页（新增）★

**新功能**: FastAPI 服务生命周期管理

```
┌──────────────────────────────────────────────────────────────┐
│ 草稿文件夹设置 ────────────────────────────────────────────── │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 剪映草稿文件夹: [未选择（将使用默认路径）            ]    │ │
│ │                 [选择文件夹...] [自动检测]               │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ FastAPI 服务管理 ──────────────────────────────────────────  │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │                                                          │ │
│ │  端口: [8000    ]                                        │ │
│ │                                                          │ │
│ │  ● 服务状态: 未启动                                      │ │
│ │  │                                                       │ │
│ │  │  🔴 = 服务未启动                                      │ │
│ │  │  🟢 = 服务运行中                                      │ │
│ │                                                          │ │
│ │  [启动服务] [停止服务]                                   │ │
│ │                                                          │ │
│ │  服务信息 ──────────────────────────────────────────────  │ │
│ │  ┌────────────────────────────────────────────────────┐ │ │
│ │  │ [14:30:15] 正在启动服务...                         │ │ │
│ │  │ [14:30:16] 服务已启动                              │ │ │
│ │  │ [14:30:16] 访问地址: http://localhost:8000        │ │ │
│ │  │ [14:30:16] API文档: http://localhost:8000/docs    │ │ │
│ │  │                                                    │ │ │
│ │  └────────────────────────────────────────────────────┘ │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│ 状态栏: 就绪                                                 │
└──────────────────────────────────────────────────────────────┘
```

## UI 组件详解

### 本地服务标签页的关键 UI 元素

#### 1. 草稿文件夹设置区域
- **位置**: 标签页顶部
- **功能**: 与"手动草稿生成"标签页相同
- **组件**:
  - 只读文本框：显示选择的文件夹路径
  - "选择文件夹..."按钮：打开文件夹选择对话框
  - "自动检测"按钮：自动查找剪映安装路径

#### 2. FastAPI 服务管理区域
- **位置**: 标签页中部，占据主要空间
- **功能**: 管理本地 FastAPI 服务

##### 2.1 端口配置
- **输入框**: 可编辑数字输入框
- **默认值**: 8000
- **有效范围**: 1024-65535
- **状态**: 服务运行时禁用

##### 2.2 服务状态显示
- **状态指示器**: 圆形指示灯
  - 🔴 红色：服务未启动
  - 🟢 绿色：服务运行中
- **状态文本**: 显示当前服务状态
  - "服务状态: 未启动"
  - "服务状态: 运行中 (端口 8000)"
  - "服务状态: 错误"

##### 2.3 服务控制按钮
- **启动服务按钮**:
  - 初始状态: 可用
  - 文本: "启动服务"
  - 行为: 在后台启动 FastAPI 服务
  
- **停止服务按钮**:
  - 初始状态: 禁用（灰色）
  - 文本: "停止服务"
  - 行为: 停止运行中的服务

##### 2.4 服务信息面板
- **类型**: 只读文本框，带滚动条
- **内容**: 带时间戳的服务日志
- **高度**: 约 8 行
- **自动滚动**: 新日志自动滚动到底部

#### 3. 状态栏
- **位置**: 窗口底部
- **显示内容**:
  - "就绪" - 默认状态
  - "输出文件夹: [路径]" - 选择文件夹后
  - "服务运行中 - http://localhost:[端口]" - 服务运行时

## 用户交互流程

### 启动服务的完整流程

```
用户操作              系统响应                   UI 变化
───────────────────────────────────────────────────────────
1. 点击"启动服务"    → 验证端口号              → 无变化
                    → 创建后台线程             

2. 服务启动中        → 日志: "正在启动服务..."  → 指示器变绿色🟢
                    → 禁用端口输入框           → "启动服务"按钮禁用
                    → 禁用"启动服务"按钮       → "停止服务"按钮启用
                    → 启用"停止服务"按钮       → 状态文本更新

3. 服务运行          → 日志: "服务已启动"      → 服务信息面板显示日志
                    → 日志: "访问地址: ..."    
                    → 日志: "API文档: ..."     
                    → 状态栏更新               → 状态栏显示服务地址
```

### 停止服务的完整流程

```
用户操作              系统响应                   UI 变化
───────────────────────────────────────────────────────────
1. 点击"停止服务"    → 设置停止标志             → 无变化
                    → 等待线程结束             

2. 服务停止中        → 日志: "正在停止服务..."  → 指示器变红色🔴
                    → 线程清理                 → "启动服务"按钮启用
                                              → "停止服务"按钮禁用
                                              → 端口输入框启用

3. 服务已停止        → 日志: "服务已停止"      → 状态文本更新
                    → 状态栏更新               → 状态栏显示"就绪"
```

## 颜色和视觉设计

### 服务状态指示器
- **红色 (RGB: 255, 0, 0)**: 服务未启动或已停止
- **绿色 (RGB: 0, 255, 0)**: 服务正常运行
- **形状**: 圆形，直径约 20 像素
- **位置**: 状态文本左侧

### 按钮状态
- **可用状态**: 正常颜色，可点击
- **禁用状态**: 灰色，不可点击
- **悬停效果**: 按钮背景色稍微变浅（系统默认）

### 文本框
- **端口输入框**: 
  - 可编辑时: 白色背景
  - 禁用时: 浅灰色背景
- **服务信息面板**:
  - 背景: 白色
  - 文本: 黑色
  - 字体: Consolas, 9pt (等宽字体)
  - 边框: 标准 Tkinter 边框

## 响应式行为

### 窗口大小调整
- 标签页内容区域：垂直和水平方向都可调整大小
- 服务信息面板：可垂直扩展以显示更多日志
- 日志面板（底部）：可通过拖动分隔条调整高度

### 最小窗口尺寸
- 建议最小宽度: 900 像素
- 建议最小高度: 700 像素

## 可访问性

### 键盘导航
- Tab 键: 在控件之间切换
- Enter 键: 激活当前焦点的按钮
- 空格键: 激活当前焦点的按钮

### 屏幕阅读器支持
- 所有按钮都有清晰的文本标签
- 状态变化会通过文本反馈给用户
- 输入框有相应的标签文本

## 与其他标签页的对比

| 特性 | 手动草稿生成 | 本地服务 | 示例标签页 |
|------|------------|---------|-----------|
| 文件夹选择 | ✓ | ✓ | ✗ |
| 自动检测 | ✓ | ✓ | ✗ |
| 文本输入 | ✓ | ✗ | ✓ |
| 生成草稿 | ✓ | ✗ | ✗ |
| 服务管理 | ✗ | ✓ | ✗ |
| 状态指示器 | ✗ | ✓ | ✗ |

## 测试建议

在实际 GUI 环境中，建议测试以下场景：

1. ✓ 标签页切换是否流畅
2. ✓ 文件夹选择和自动检测功能
3. ✓ 服务启动和停止
4. ✓ 端口配置和验证
5. ✓ 状态指示器颜色变化
6. ✓ 日志信息显示和滚动
7. ✓ 窗口大小调整时的布局
8. ✓ 关闭应用时的资源清理

## 总结

新增的"本地服务"标签页成功集成到应用中，提供了：
- 清晰的视觉反馈（状态指示器）
- 直观的服务控制（启动/停止按钮）
- 实时的状态信息（日志面板）
- 一致的用户体验（与其他标签页风格统一）

该实现为后续添加实际的 FastAPI 服务功能提供了完善的 UI 基础。
