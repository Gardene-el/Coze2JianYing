# Create Draft Tool

创建新的剪映草稿并返回UUID标识符的Coze工具函数。

## 功能描述

本工具用于创建新的剪映草稿项目，设置基本的项目参数（如分辨率、帧率等），并在`/tmp/jianying_assistant/drafts/`目录中创建对应的草稿存储文件夹。创建成功后返回一个UUID标识符，用于后续的草稿操作和管理。

## 核心特性

### UUID草稿管理系统
- 为每个草稿生成唯一的UUID标识符
- 在`/tmp/jianying_assistant/drafts/{uuid}`目录中存储草稿数据
- 支持多个草稿的并发管理
- 避免Coze变量索引系统的数据干扰

### 完整项目配置
- 支持自定义项目分辨率和帧率
- 包含时间戳和状态跟踪

### 安全的文件管理
- 自动创建必要的目录结构
- 错误处理和回滚机制
- 输入参数验证和清理

## 输入参数

### Input 类型定义
```python
class Input(NamedTuple):
    draft_name: str = "Coze剪映项目"    # 项目名称
    width: int = 1920                    # 视频宽度(像素)
    height: int = 1080                   # 视频高度(像素)
    fps: int = 30                        # 帧率
```

### 参数详细说明

#### draft_name (string)
- **描述**: 项目名称，用于标识草稿
- **默认值**: "Coze剪映项目"
- **约束**: 任意字符串，建议使用有意义的项目名称

#### width (integer)
- **描述**: 视频宽度，单位像素
- **默认值**: 1920
- **约束**: 必须大于0，常用值：1920(1080p)、1280(720p)、3840(4K)

#### height (integer)
- **描述**: 视频高度，单位像素
- **默认值**: 1080
- **约束**: 必须大于0，常用值：1080(1080p)、720(720p)、2160(4K)

#### fps (integer)
- **描述**: 视频帧率，单位fps
- **默认值**: 30
- **约束**: 1-120之间，常用值：24、25、30、50、60

## 输出结果

### 返回值格式

返回 Dict[str, Any] 格式（确保 Coze 平台正确序列化为 JSON 对象）：

```python
{
    "draft_id": str,      # 生成的UUID标识符
    "success": bool,      # 操作是否成功
    "message": str        # 状态消息
}
```

### 输出字段说明

#### draft_id (string)
- **描述**: 草稿的唯一UUID标识符
- **格式**: 标准UUID格式，如"123e4567-e89b-12d3-a456-426614174000"
- **用途**: 用于后续的草稿操作和管理

#### success (boolean)
- **描述**: 表示草稿创建是否成功
- **true**: 创建成功
- **false**: 创建失败

#### message (string)
- **描述**: 操作结果的详细描述
- **成功示例**: "草稿创建成功，ID: 123e4567-e89b-12d3-a456-426614174000"
- **失败示例**: "参数验证失败: Invalid dimensions: -1x-1"

## 使用示例

### 基本用法

#### 使用默认参数创建草稿
```json
{
  "draft_name": "我的第一个项目"
}
```

**预期输出**:
```json
{
  "draft_id": "123e4567-e89b-12d3-a456-426614174000",
  "success": true,
  "message": "草稿创建成功，ID: 123e4567-e89b-12d3-a456-426614174000"
}
```

#### 创建4K高质量草稿
```json
{
  "draft_name": "4K超清项目",
  "width": 3840,
  "height": 2160,
  "fps": 60
}
```

#### 创建竖屏短视频草稿
```json
{
  "draft_name": "抖音短视频",
  "width": 1080,
  "height": 1920,
  "fps": 30
}
```

### 在Coze工作流中的使用

```json
{
  "tool": "create_draft",
  "input": {
    "draft_name": "{{user_project_name}}",
    "width": 1920,
    "height": 1080,
    "fps": 30
  },
  "output_variable": "draft_info"
}
```

## 技术实现

### 文件系统结构
创建草稿时，会在`/tmp`目录下生成以下结构：
```
/tmp/{uuid}/
├── draft_config.json    # 草稿配置文件
└── (后续会添加其他文件)
```

### draft_config.json结构
```json
{
  "draft_id": "123e4567-e89b-12d3-a456-426614174000",
  "project": {
    "name": "项目名称",
    "width": 1920,
    "height": 1080,
    "fps": 30
  },
  "media_resources": [],
  "tracks": [],
  "total_duration_ms": 0,
  "created_timestamp": 1703123456.789,
  "last_modified": 1703123456.789,
  "status": "created"
}
```

### 参数验证机制
- **尺寸验证**: 宽度和高度必须大于0
- **帧率验证**: fps必须在1-120范围内
- **质量验证**: 视频和音频质量必须在预定义列表中
- **颜色验证**: 背景色必须是有效的十六进制颜色代码

### 错误处理
- 输入参数验证失败时返回详细错误信息
- 文件系统操作失败时提供具体错误原因
- 所有异常都被捕获并转换为友好的错误消息

## 与其他工具的协作

### 后续工具链
1. **create_draft** → 创建基础草稿结构
2. **add_media_tracks** → 添加视频/音频轨道
3. **add_text_tracks** → 添加文字/字幕轨道
4. **add_effects** → 添加特效和滤镜
5. **export_drafts** → 导出完整草稿数据

### UUID传递模式
```
create_draft → draft_id → add_content_tools → draft_id → export_drafts
```

## 注意事项

### Coze平台限制
- **文件系统约束**: 使用`/tmp`目录，空间限制512MB
- **无状态设计**: 所有状态通过文件系统持久化
- **UUID依赖**: 后续操作必须使用返回的draft_id

### 性能考虑
- **目录创建**: 使用`exist_ok=True`避免重复创建错误
- **JSON序列化**: 使用UTF-8编码支持中文内容
- **内存管理**: 及时释放临时变量和文件句柄

### 安全性
- **路径安全**: UUID格式确保路径安全性
- **权限控制**: 自动设置适当的文件权限
- **数据隔离**: 每个草稿独立存储，避免冲突

### 最佳实践
- **命名规范**: 使用有意义的项目名称便于管理
- **参数选择**: 根据实际需求选择合适的质量参数
- **错误处理**: 检查返回的success字段确认操作结果
- **清理机制**: 及时使用export_drafts导出并清理临时文件

### 故障排除

#### 常见错误
1. **"参数验证失败"**: 检查输入参数是否在有效范围内
2. **"创建草稿文件夹失败"**: 检查/tmp目录权限和可用空间
3. **"创建草稿配置失败"**: 检查文件系统写入权限

#### 调试建议
- 检查Coze工具日志获取详细错误信息
- 验证输入参数格式和取值范围
- 确认/tmp目录可用空间充足

这个工具为整个Coze剪映工作流提供了稳定的起点，通过UUID管理系统有效解决了Coze平台变量索引的复杂性问题。