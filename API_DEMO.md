# FastAPI ç¤ºä¾‹æ¥å£åŠŸèƒ½æ¼”ç¤º

æœ¬æ–‡æ¡£æ¼”ç¤ºé¡¹ç›®ä¸­æ‰€æœ‰ FastAPI æ¥å£çš„å®é™…ä½¿ç”¨æ–¹æ³•å’Œé¢„æœŸå“åº”ã€‚

## ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
2. [å¯åŠ¨æœåŠ¡](#å¯åŠ¨æœåŠ¡)
3. [æ¥å£æµ‹è¯•ç¤ºä¾‹](#æ¥å£æµ‹è¯•ç¤ºä¾‹)
4. [å®Œæ•´å·¥ä½œæµæ¼”ç¤º](#å®Œæ•´å·¥ä½œæµæ¼”ç¤º)

---

## ç¯å¢ƒå‡†å¤‡

### æ£€æŸ¥ä¾èµ–

```powershell
# ç¡®ä¿å·²å®‰è£…å¿…è¦çš„åŒ…
pip list | Select-String -Pattern "fastapi|uvicorn|pydantic|requests"
```

### å®‰è£…ç¼ºå¤±ä¾èµ–

```powershell
pip install fastapi uvicorn[standard] pydantic requests
```

---

## å¯åŠ¨æœåŠ¡

### æ–¹å¼ 1: ä½¿ç”¨å¯åŠ¨è„šæœ¬

```powershell
# Python è„šæœ¬
python start_api.py

# æˆ–ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆåŒå‡»è¿è¡Œï¼‰
.\start_api.bat
```

### æ–¹å¼ 2: ç›´æ¥å‘½ä»¤

```powershell
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡è½½ï¼‰
uvicorn app.api_main:app --reload --host 127.0.0.1 --port 8000

# æˆ–ä½¿ç”¨ Python æ¨¡å—
python -m app.api_main
```

### éªŒè¯æœåŠ¡å¯åŠ¨

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼šhttp://127.0.0.1:8000

é¢„æœŸå“åº”ï¼š

```json
{
  "message": "Welcome to Cozeå‰ªæ˜ è‰ç¨¿ç”Ÿæˆå™¨ API",
  "docs": "/docs",
  "redoc": "/redoc",
  "version": "1.0.0",
  "timestamp": "2025-11-02T..."
}
```

---

## æ¥å£æµ‹è¯•ç¤ºä¾‹

### 1. åŸºç¡€æ¥å£æµ‹è¯•

#### å¥åº·æ£€æŸ¥ (GET)

```powershell
curl http://127.0.0.1:8000/api/example/health
```

**é¢„æœŸå“åº”:**

```json
{
  "status": "healthy",
  "timestamp": "2025-11-02T10:30:00.123456",
  "version": "1.0.0"
}
```

---

### 2. CRUD æ“ä½œæµ‹è¯•

#### åˆ›å»º Item (POST)

```powershell
curl -X POST http://127.0.0.1:8000/api/example/items `
  -H "Content-Type: application/json" `
  -d '{\"name\":\"æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®\",\"description\":\"æµ‹è¯•æè¿°\",\"price\":99.99,\"is_active\":true}'
```

**é¢„æœŸå“åº” (201 Created):**

```json
{
  "id": 1,
  "name": "æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®",
  "description": "æµ‹è¯•æè¿°",
  "price": 99.99,
  "is_active": true,
  "created_at": "2025-11-02T10:30:15.123456"
}
```

#### è·å–æ‰€æœ‰ Items (GET)

```powershell
curl http://127.0.0.1:8000/api/example/items
```

**é¢„æœŸå“åº”:**

```json
[
  {
    "id": 1,
    "name": "æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®",
    "description": "æµ‹è¯•æè¿°",
    "price": 99.99,
    "is_active": true,
    "created_at": "2025-11-02T10:30:15.123456"
  }
]
```

#### å¸¦æŸ¥è¯¢å‚æ•°è·å– (GET with Query)

```powershell
# åˆ†é¡µæŸ¥è¯¢
curl "http://127.0.0.1:8000/api/example/items?skip=0&limit=5"

# æœç´¢æŸ¥è¯¢
curl "http://127.0.0.1:8000/api/example/items?search=é¡¹ç›®&is_active=true"
```

#### è·å–å•ä¸ª Item (GET)

```powershell
curl http://127.0.0.1:8000/api/example/items/1
```

#### éƒ¨åˆ†æ›´æ–° (PATCH)

```powershell
curl -X PATCH http://127.0.0.1:8000/api/example/items/1 `
  -H "Content-Type: application/json" `
  -d '{\"price\":199.99}'
```

**é¢„æœŸå“åº”:**

```json
{
  "id": 1,
  "name": "æˆ‘çš„ç¬¬ä¸€ä¸ªé¡¹ç›®",
  "description": "æµ‹è¯•æè¿°",
  "price": 199.99,
  "is_active": true,
  "created_at": "2025-11-02T10:30:15.123456"
}
```

#### å®Œæ•´æ›´æ–° (PUT)

```powershell
curl -X PUT http://127.0.0.1:8000/api/example/items/1 `
  -H "Content-Type: application/json" `
  -d '{\"name\":\"æ›´æ–°åçš„é¡¹ç›®\",\"description\":\"æ–°æè¿°\",\"price\":299.99,\"is_active\":false}'
```

#### åˆ é™¤ Item (DELETE)

```powershell
curl -X DELETE http://127.0.0.1:8000/api/example/items/1
```

**é¢„æœŸå“åº”:**

```json
{
  "message": "Item 1 deleted successfully",
  "status": "success"
}
```

---

### 3. æ‰¹é‡æ“ä½œ

#### æ‰¹é‡åˆ›å»º Items (POST)

```powershell
curl -X POST http://127.0.0.1:8000/api/example/items/batch `
  -H "Content-Type: application/json" `
  -d '{\"items\":[{\"name\":\"é¡¹ç›®A\",\"price\":10},{\"name\":\"é¡¹ç›®B\",\"price\":20},{\"name\":\"é¡¹ç›®C\",\"price\":30}]}'
```

**é¢„æœŸå“åº”:**

```json
{
  "created_count": 3,
  "items": [
    {"id": 2, "name": "é¡¹ç›®A", "price": 10, ...},
    {"id": 3, "name": "é¡¹ç›®B", "price": 20, ...},
    {"id": 4, "name": "é¡¹ç›®C", "price": 30, ...}
  ]
}
```

---

### 4. æ–‡ä»¶æ“ä½œ

#### æ–‡ä»¶ä¸Šä¼  (POST multipart/form-data)

```powershell
# å…ˆåˆ›å»ºæµ‹è¯•æ–‡ä»¶
"è¿™æ˜¯æµ‹è¯•æ–‡ä»¶çš„å†…å®¹" | Out-File -FilePath test_upload.txt -Encoding utf8

# ä¸Šä¼ æ–‡ä»¶
curl -X POST http://127.0.0.1:8000/api/example/upload `
  -F "file=@test_upload.txt"
```

**é¢„æœŸå“åº”:**

```json
{
  "filename": "test_upload.txt",
  "size": 27,
  "content_type": "text/plain",
  "message": "File uploaded successfully"
}
```

#### æ–‡ä»¶ä¸‹è½½ (GET)

```powershell
curl http://127.0.0.1:8000/api/example/download -o downloaded.txt
```

æ–‡ä»¶å°†è¢«ä¿å­˜ä¸º `downloaded.txt`ã€‚

---

### 5. è¡¨å•æäº¤

```powershell
curl -X POST http://127.0.0.1:8000/api/example/form `
  -F "name=å¼ ä¸‰" `
  -F "email=zhangsan@example.com" `
  -F "age=25" `
  -F "message=ä½ å¥½ä¸–ç•Œ"
```

**é¢„æœŸå“åº”:**

```json
{
  "message": "Form received: å¼ ä¸‰, zhangsan@example.com, age 25",
  "status": "success"
}
```

---

### 6. è¯·æ±‚å¤´å’Œ Cookies

#### è‡ªå®šä¹‰è¯·æ±‚å¤´ (GET with Headers)

```powershell
curl http://127.0.0.1:8000/api/example/headers `
  -H "X-Custom-Header: my-value" `
  -H "User-Agent: MyApp/1.0"
```

**é¢„æœŸå“åº”:**

```json
{
  "user_agent": "MyApp/1.0",
  "accept_language": null,
  "custom_header": "my-value"
}
```

#### Cookies (GET with Cookies)

```powershell
curl http://127.0.0.1:8000/api/example/cookies `
  --cookie "session_id=abc123; user_id=user456"
```

**é¢„æœŸå“åº”:**

```json
{
  "session_id": "abc123",
  "user_id": "user456"
}
```

---

### 7. æµå¼å“åº”

```powershell
curl http://127.0.0.1:8000/api/example/stream
```

**é¢„æœŸå“åº” (æµå¼):**

```
data: Message 0

data: Message 1

data: Message 2

...
```

---

### 8. æ··åˆå‚æ•°

```powershell
curl -X POST "http://127.0.0.1:8000/api/example/mixed/123?name=æµ‹è¯•" `
  -H "Content-Type: application/json" `
  -H "X-Token: secret-123" `
  -d '{\"name\":\"æ··åˆæµ‹è¯•\",\"price\":100}'
```

**é¢„æœŸå“åº”:**

```json
{
  "message": "Received: id=123, name=æµ‹è¯•, item=æ··åˆæµ‹è¯•, token=secret-123",
  "status": "success"
}
```

---

### 9. é”™è¯¯å¤„ç†

#### 404 é”™è¯¯

```powershell
curl http://127.0.0.1:8000/api/example/error/404
```

**é¢„æœŸå“åº” (404):**

```json
{
  "detail": "Resource not found"
}
```

#### 400 é”™è¯¯

```powershell
curl http://127.0.0.1:8000/api/example/error/400
```

**é¢„æœŸå“åº” (400):**

```json
{
  "detail": "This is a simulated bad request error"
}
```

#### 500 é”™è¯¯

```powershell
curl http://127.0.0.1:8000/api/example/error/500
```

**é¢„æœŸå“åº” (500):**

```json
{
  "detail": "This is a simulated server error"
}
```

---

## å®Œæ•´å·¥ä½œæµæ¼”ç¤º

### ä½¿ç”¨ Python æµ‹è¯•è„šæœ¬

è¿™æ˜¯æœ€ç®€å•çš„æµ‹è¯•æ–¹å¼ï¼š

```powershell
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python test_api_examples.py
```

æµ‹è¯•è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. âœ… æµ‹è¯•æ ¹è·¯å¾„å’Œå¥åº·æ£€æŸ¥
2. âœ… åˆ›å»ºå•ä¸ª Item
3. âœ… è·å– Items åˆ—è¡¨ï¼ˆå¸¦å„ç§æŸ¥è¯¢å‚æ•°ï¼‰
4. âœ… è·å–å•ä¸ª Item
5. âœ… éƒ¨åˆ†æ›´æ–° Item (PATCH)
6. âœ… å®Œæ•´æ›´æ–° Item (PUT)
7. âœ… æ‰¹é‡åˆ›å»º Items
8. âœ… æ–‡ä»¶ä¸Šä¼ 
9. âœ… è¡¨å•æäº¤
10. âœ… è‡ªå®šä¹‰è¯·æ±‚å¤´
11. âœ… Cookies å¤„ç†
12. âœ… æ–‡ä»¶ä¸‹è½½
13. âœ… æµå¼å“åº”
14. âœ… æ··åˆå‚æ•°
15. âœ… é”™è¯¯å¤„ç†
16. âœ… åˆ é™¤ Item

**é¢„æœŸè¾“å‡ºç¤ºä¾‹:**

```
ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€
FastAPI æ¥å£æµ‹è¯•å¼€å§‹
ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€ğŸš€

ğŸ“Œ ç¬¬ä¸€éƒ¨åˆ†: åŸºç¡€æ¥å£æµ‹è¯•
============================================================
ğŸ“‹ æ ¹è·¯å¾„
============================================================
çŠ¶æ€ç : 200
...

ğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“Š
æµ‹è¯•æ€»ç»“
ğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“ŠğŸ“Š

âœ… é€šè¿‡ - æ ¹è·¯å¾„
âœ… é€šè¿‡ - å¥åº·æ£€æŸ¥
âœ… é€šè¿‡ - åˆ›å»ºItem
...

============================================================
æ€»è®¡: 16/16 æµ‹è¯•é€šè¿‡
æˆåŠŸç‡: 100.0%
============================================================

ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
```

---

## ä½¿ç”¨ Swagger UI äº¤äº’å¼æµ‹è¯•

è¿™æ˜¯**æœ€æ¨è**çš„æµ‹è¯•æ–¹å¼ï¼š

1. å¯åŠ¨æœåŠ¡åï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼šhttp://127.0.0.1:8000/docs
2. æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æ¥å£
3. ç‚¹å‡»ä»»æ„æ¥å£å±•å¼€
4. ç‚¹å‡» **"Try it out"** æŒ‰é’®
5. å¡«å†™å¿…è¦çš„å‚æ•°
6. ç‚¹å‡» **"Execute"** æ‰§è¡Œè¯·æ±‚
7. æŸ¥çœ‹å“åº”ç»“æœ

### Swagger UI ç•Œé¢åŠŸèƒ½

- ğŸ“š **è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£**: æ‰€æœ‰æ¥å£éƒ½æœ‰è¯¦ç»†è¯´æ˜
- ğŸ¯ **äº¤äº’å¼æµ‹è¯•**: ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•æ¥å£
- ğŸ“ **å‚æ•°éªŒè¯**: è‡ªåŠ¨æ˜¾ç¤ºå¿…å¡«å‚æ•°å’Œæ•°æ®ç±»å‹
- ğŸ“Š **ç¤ºä¾‹æ•°æ®**: è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚å’Œå“åº”ç¤ºä¾‹
- ğŸ” **Schema æŸ¥çœ‹**: æŸ¥çœ‹è¯¦ç»†çš„æ•°æ®æ¨¡å‹å®šä¹‰

---

## éªŒè¯æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥ç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼š

- [ ] âœ… æœåŠ¡èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨
- [ ] âœ… Swagger UI å¯ä»¥è®¿é—® (http://127.0.0.1:8000/docs)
- [ ] âœ… å¥åº·æ£€æŸ¥æ¥å£è¿”å› 200
- [ ] âœ… å¯ä»¥åˆ›å»º Item (POST)
- [ ] âœ… å¯ä»¥è·å– Items åˆ—è¡¨ (GET)
- [ ] âœ… æŸ¥è¯¢å‚æ•°æ­£å¸¸å·¥ä½œï¼ˆåˆ†é¡µã€æœç´¢ï¼‰
- [ ] âœ… å¯ä»¥è·å–å•ä¸ª Item (GET)
- [ ] âœ… å¯ä»¥éƒ¨åˆ†æ›´æ–° Item (PATCH)
- [ ] âœ… å¯ä»¥å®Œæ•´æ›´æ–° Item (PUT)
- [ ] âœ… å¯ä»¥åˆ é™¤ Item (DELETE)
- [ ] âœ… æ‰¹é‡åˆ›å»ºåŠŸèƒ½æ­£å¸¸
- [ ] âœ… æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] âœ… æ–‡ä»¶ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- [ ] âœ… è¡¨å•æäº¤åŠŸèƒ½æ­£å¸¸
- [ ] âœ… è¯·æ±‚å¤´è¯»å–æ­£å¸¸
- [ ] âœ… Cookies è¯»å–æ­£å¸¸
- [ ] âœ… æµå¼å“åº”æ­£å¸¸
- [ ] âœ… æ··åˆå‚æ•°åŠŸèƒ½æ­£å¸¸
- [ ] âœ… é”™è¯¯å¤„ç†æ­£å¸¸ï¼ˆ404, 400, 500ï¼‰
- [ ] âœ… Python æµ‹è¯•è„šæœ¬å…¨éƒ¨é€šè¿‡

---

## å¸¸è§é—®é¢˜

### Q: æœåŠ¡å¯åŠ¨åæ— æ³•è®¿é—®ï¼Ÿ

A: æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼Œç¡®ä¿ 8000 ç«¯å£æœªè¢«å ç”¨ï¼š

```powershell
netstat -ano | findstr :8000
```

### Q: æµ‹è¯•è„šæœ¬æŠ¥é”™ "Connection refused"ï¼Ÿ

A: ç¡®ä¿ FastAPI æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”ä½¿ç”¨æ­£ç¡®çš„åœ°å€å’Œç«¯å£ã€‚

### Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Ÿ

A: æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼Ÿ

A: æŸ¥çœ‹ç»ˆç«¯è¾“å‡ºï¼Œuvicorn ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚å’Œé”™è¯¯ä¿¡æ¯ã€‚

---

## ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»æŒæ¡äº† FastAPI çš„åŸºç¡€ç”¨æ³•ï¼Œå¯ä»¥ï¼š

1. ğŸ“– é˜…è¯» [FastAPI å®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
2. ğŸ”§ ä¿®æ”¹ç¤ºä¾‹ä»£ç ï¼Œæ·»åŠ è‡ªå·±çš„æ¥å£
3. ğŸ’¾ é›†æˆæ•°æ®åº“ï¼ˆSQLAlchemyï¼‰
4. ğŸ” æ·»åŠ è®¤è¯å’Œæˆæƒï¼ˆOAuth2, JWTï¼‰
5. ğŸ“¦ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**ç¥ä½ æµ‹è¯•æ„‰å¿«ï¼** ğŸ‰
