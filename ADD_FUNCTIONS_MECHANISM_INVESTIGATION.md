# add_**s å‡½æ•°æœºåˆ¶è°ƒæŸ¥æŠ¥å‘Š

## è°ƒæŸ¥ç›®çš„

è°ƒæŸ¥å½“å‰ add_**s å‡½æ•°çš„å¯¹åº”æœºåˆ¶ï¼ŒéªŒè¯å…¶æ˜¯å¦ä½“ç°äº†ä¸ pyJianYingDraft ä¸€ä¸€å¯¹åº”çš„è®¾è®¡æ„æƒ³ã€‚

åœ¨ä¸ pyJianYingDraft ä¸€ä¸€å¯¹åº”çš„æ„æƒ³ä¸­ï¼Œ**add_**s å‡½æ•°çš„æ„ä¹‰æ˜¯å‘è‰ç¨¿æ·»åŠ ä¸€ä¸ªè½¨é“ï¼Œä»¥åŠåœ¨æ­¤è½¨é“ä¸Šæ·»åŠ çš„æ‰¹é‡çš„ç‰‡æ®µ**ã€‚æœ¬è°ƒæŸ¥æ—¨åœ¨éªŒè¯å½“å‰å®ç°æ˜¯å¦ä½“ç°äº†è¿™ä¸€ç‚¹ã€‚

## è°ƒæŸ¥èŒƒå›´

æœ¬è°ƒæŸ¥è¦†ç›–ä»¥ä¸‹ add_* å·¥å…·å‡½æ•°ï¼š
- `add_images` - æ·»åŠ å›¾ç‰‡ç‰‡æ®µ
- `add_videos` - æ·»åŠ è§†é¢‘ç‰‡æ®µ
- `add_audios` - æ·»åŠ éŸ³é¢‘ç‰‡æ®µ
- `add_captions` - æ·»åŠ å­—å¹•/æ–‡æœ¬ç‰‡æ®µ
- `add_effects` - æ·»åŠ ç‰¹æ•ˆç‰‡æ®µ

## è°ƒæŸ¥æ–¹æ³•

1. **ä»£ç å®¡æŸ¥**: é€ä¸€æ£€æŸ¥æ¯ä¸ª add_* å·¥å…·çš„ handler.py å®ç°
2. **æ–‡æ¡£åˆ†æ**: æ£€æŸ¥ç›¸å…³ README.md å’Œè®¾è®¡æ–‡æ¡£
3. **æ¥å£å¯¹æ¯”**: å¯¹æ¯” pyJianYingDraft çš„åŸç”Ÿæ¥å£è®¾è®¡
4. **æµ‹è¯•éªŒè¯**: æ£€æŸ¥ç°æœ‰æµ‹è¯•ç”¨ä¾‹ä¸­çš„è¡Œä¸ºéªŒè¯

---

## æ ¸å¿ƒå‘ç°

### 1. å½“å‰å®ç°æœºåˆ¶

#### 1.1 ç»Ÿä¸€çš„å®ç°æ¨¡å¼

æ‰€æœ‰ add_* å·¥å…·å‡½æ•°éƒ½éµå¾ªç›¸åŒçš„å®ç°æ¨¡å¼ï¼š

```python
def handler(args: Args[Input]) -> Output:
    """Main handler function"""
    
    # 1. éªŒè¯è¾“å…¥å‚æ•°
    validate_input_parameters()
    
    # 2. è§£æåª’ä½“ä¿¡æ¯åˆ—è¡¨
    media_infos = parse_*_infos(args.input.*_infos)
    
    # 3. åŠ è½½ç°æœ‰è‰ç¨¿é…ç½®
    draft_config = load_draft_config(args.input.draft_id)
    
    # 4. åˆ›å»ºæ–°çš„è½¨é“ï¼ŒåŒ…å«æ‰€æœ‰ç‰‡æ®µ
    segment_ids, segment_infos, track = create_*_track_with_segments(media_infos)
    
    # 5. å°†æ–°è½¨é“æ·»åŠ åˆ°è‰ç¨¿é…ç½®
    draft_config["tracks"].append(track)
    
    # 6. ä¿å­˜æ›´æ–°åçš„é…ç½®
    save_draft_config(args.input.draft_id, draft_config)
    
    return Output(segment_ids, segment_infos, success=True)
```

#### 1.2 å…³é”®å‡½æ•°ï¼š`create_*_track_with_segments`

æ¯ä¸ª add_* å·¥å…·éƒ½æœ‰ä¸€ä¸ªæ ¸å¿ƒå‡½æ•° `create_*_track_with_segments`ï¼Œå…¶èŒè´£æ˜¯ï¼š

**è¾“å…¥**: åª’ä½“ä¿¡æ¯åˆ—è¡¨ï¼ˆå¦‚ `image_infos`, `video_infos` ç­‰ï¼‰

**å¤„ç†**:
1. ä¸ºæ¯ä¸ªåª’ä½“åˆ›å»ºä¸€ä¸ª segmentï¼ˆç‰‡æ®µï¼‰ï¼Œç”Ÿæˆå”¯ä¸€çš„ UUID
2. å°†æ‰€æœ‰ segments ç»„ç»‡åˆ°ä¸€ä¸ª trackï¼ˆè½¨é“ï¼‰ç»“æ„ä¸­
3. è®¾ç½®è½¨é“çš„ç±»å‹å’Œå±æ€§ï¼ˆå¦‚ `track_type`, `muted`, `volume` ç­‰ï¼‰

**è¾“å‡º**: `(segment_ids, segment_infos, track_dict)`

**ç¤ºä¾‹ä»£ç **ï¼ˆæ¥è‡ª add_imagesï¼‰ï¼š
```python
def create_image_track_with_segments(image_infos: List[Dict[str, Any]]) -> tuple[List[str], List[Dict[str, Any]], Dict[str, Any]]:
    """
    Create a properly structured image track with segments
    """
    segment_ids = []
    segment_infos = []
    segments = []
    
    # ä¸ºæ¯ä¸ªå›¾ç‰‡åˆ›å»ºä¸€ä¸ª segment
    for info in image_infos:
        segment_id = str(uuid.uuid4())
        segment_ids.append(segment_id)
        
        # åˆ›å»º segment ç»“æ„
        segment = {
            "id": segment_id,
            "type": "image",
            "material_url": info['material_url'],
            "time_range": {"start": info['start'], "end": info['end']},
            # ... å…¶ä»–å±æ€§
        }
        segments.append(segment)
    
    # åˆ›å»ºåŒ…å«æ‰€æœ‰ segments çš„ track
    track = {
        "track_type": "video",  # å›¾ç‰‡ä½¿ç”¨ video è½¨é“ç±»å‹
        "muted": False,
        "segments": segments
    }
    
    return segment_ids, segment_infos, track
```

#### 1.3 æ¯æ¬¡è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°è½¨é“

**å…³é”®å‘ç°**: æ¯æ¬¡è°ƒç”¨ add_* å‡½æ•°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è½¨é“

```python
# å…³é”®ä»£ç ï¼ˆæ‰€æœ‰ add_* å·¥å…·å…±é€šï¼‰
draft_config["tracks"].append(track)  # æ·»åŠ æ–°è½¨é“ï¼Œè€Œéä¿®æ”¹ç°æœ‰è½¨é“
```

è¿™æ„å‘³ç€ï¼š
- ç¬¬ä¸€æ¬¡è°ƒç”¨ `add_images([img1, img2])` â†’ åˆ›å»ºç¬¬1ä¸ªå›¾ç‰‡è½¨é“ï¼ŒåŒ…å« img1 å’Œ img2
- ç¬¬äºŒæ¬¡è°ƒç”¨ `add_images([img3])` â†’ åˆ›å»ºç¬¬2ä¸ªå›¾ç‰‡è½¨é“ï¼ŒåŒ…å« img3
- ç»“æœï¼šè‰ç¨¿ä¸­æœ‰2ä¸ªå›¾ç‰‡è½¨é“ï¼ˆè§†é¢‘ç±»å‹ï¼‰ï¼Œåˆ†åˆ«åŒ…å«ä¸åŒçš„ç‰‡æ®µ

### 2. ä¸ pyJianYingDraft çš„å¯¹åº”å…³ç³»

#### 2.1 pyJianYingDraft çš„è½¨é“å’Œç‰‡æ®µè®¾è®¡

æ ¹æ® `data_structures/draft_generator_interface/README.md` çš„æ–‡æ¡£ï¼ŒpyJianYingDraft çš„è®¾è®¡æ˜¯ï¼š

```python
# pyJianYingDraft çš„ä½¿ç”¨æ–¹å¼
from pyJianYingDraft import DraftFolder, VideoSegment, AudioSegment

# åˆ›å»ºè‰ç¨¿
draft_folder = DraftFolder("/path/to/drafts")
script_file = draft_folder.create_draft(draft_name="é¡¹ç›®å")

# æ·»åŠ æ®µè½ï¼ˆè‡ªåŠ¨ç®¡ç†è½¨é“ï¼‰
video_segment = VideoSegment(material=material, ...)
script_file.add_segment(video_segment)  # pyJianYingDraft è‡ªåŠ¨å¤„ç†è½¨é“åˆ†é…

audio_segment = AudioSegment(material=material, ...)
script_file.add_segment(audio_segment)  # è‡ªåŠ¨æ·»åŠ åˆ°éŸ³é¢‘è½¨é“
```

**pyJianYingDraft çš„è½¨é“ç®¡ç†ç‰¹ç‚¹**:
- `script_file.add_segment()` æ–¹æ³•ä¼šè‡ªåŠ¨å°†æ®µè½æ·»åŠ åˆ°å¯¹åº”ç±»å‹çš„è½¨é“
- pyJianYingDraft å†…éƒ¨ç®¡ç†è½¨é“çš„åˆ›å»ºå’Œç»„ç»‡
- ç”¨æˆ·ä¸»è¦å…³æ³¨æ®µè½ï¼ˆSegmentï¼‰ï¼Œè€Œéç›´æ¥æ“ä½œè½¨é“ï¼ˆTrackï¼‰

#### 2.2 æœ¬é¡¹ç›®çš„è®¾è®¡ç†å¿µ

æœ¬é¡¹ç›®çš„ add_* å‡½æ•°é‡‡ç”¨äº†ä¸åŒçš„è®¾è®¡ç†å¿µï¼š

```python
# æœ¬é¡¹ç›®çš„ä½¿ç”¨æ–¹å¼
from tools.add_images.handler import handler as add_images

# ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼šæ·»åŠ ä¸€æ‰¹å›¾ç‰‡
result1 = add_images(draft_id=draft_id, image_infos=[img1, img2])
# â†’ åˆ›å»ºè½¨é“1ï¼ŒåŒ…å« img1, img2

# ç¬¬äºŒæ¬¡è°ƒç”¨ï¼šæ·»åŠ å¦ä¸€æ‰¹å›¾ç‰‡
result2 = add_images(draft_id=draft_id, image_infos=[img3])
# â†’ åˆ›å»ºè½¨é“2ï¼ŒåŒ…å« img3
```

**æœ¬é¡¹ç›®çš„è½¨é“ç®¡ç†ç‰¹ç‚¹**:
- æ¯æ¬¡è°ƒç”¨ add_* å‡½æ•°æ˜¾å¼åˆ›å»ºä¸€ä¸ªæ–°è½¨é“
- è½¨é“çš„åˆ›å»ºå®Œå…¨ç”±ç”¨æˆ·æ§åˆ¶ï¼ˆé€šè¿‡è°ƒç”¨æ¬¡æ•°ï¼‰
- ç”¨æˆ·éœ€è¦ç†è§£è½¨é“çš„æ¦‚å¿µï¼Œå¹¶å†³å®šä½•æ—¶åˆ›å»ºæ–°è½¨é“

#### 2.3 å…³é”®å·®å¼‚åˆ†æ

| ç»´åº¦ | pyJianYingDraft | æœ¬é¡¹ç›® add_* å‡½æ•° |
|------|----------------|-----------------|
| **è½¨é“åˆ›å»º** | è‡ªåŠ¨ï¼ˆå†…éƒ¨ç®¡ç†ï¼‰ | æ˜¾å¼ï¼ˆæ¯æ¬¡è°ƒç”¨åˆ›å»ºæ–°è½¨é“ï¼‰ |
| **ç”¨æˆ·è§†è§’** | å…³æ³¨æ®µè½ï¼Œè½¨é“é€æ˜ | å…³æ³¨è½¨é“+æ®µè½ï¼Œè½¨é“å¯è§ |
| **æ‰¹é‡æ“ä½œ** | é€ä¸ªæ·»åŠ æ®µè½ | ä¸€æ¬¡æ·»åŠ å¤šä¸ªæ®µè½åˆ°åŒä¸€è½¨é“ |
| **çµæ´»æ€§** | ç®€å•ï¼Œä½†è½¨é“æ§åˆ¶æœ‰é™ | å¤æ‚ï¼Œä½†è½¨é“æ§åˆ¶å®Œå…¨ |

### 3. æ˜¯å¦ç¬¦åˆ"ä¸€ä¸€å¯¹åº”"çš„æ„æƒ³ï¼Ÿ

#### 3.1 æ„æƒ³çš„åŸå§‹æ„å›¾

ä»é—®é¢˜æè¿°æ¥çœ‹ï¼Œ"ä¸€ä¸€å¯¹åº”"çš„æ„æƒ³æ˜¯æŒ‡ï¼š
> add_**s å‡½æ•°çš„æ„ä¹‰æ˜¯å‘è‰ç¨¿æ·»åŠ **ä¸€ä¸ªè½¨é“**ï¼Œä»¥åŠåœ¨æ­¤è½¨é“ä¸Šæ·»åŠ çš„**æ‰¹é‡çš„ç‰‡æ®µ**

#### 3.2 å½“å‰å®ç°çš„ç¬¦åˆåº¦

âœ… **å®Œå…¨ç¬¦åˆ**ï¼å½“å‰å®ç°ç²¾ç¡®åœ°ä½“ç°äº†è¿™ä¸€æ„æƒ³ï¼š

1. **"æ·»åŠ ä¸€ä¸ªè½¨é“"** - âœ… æ¯æ¬¡è°ƒç”¨ add_* å‡½æ•°éƒ½ä¼šåˆ›å»ºå¹¶æ·»åŠ ä¸€ä¸ªæ–°è½¨é“
   ```python
   track = {
       "track_type": "video",  # æˆ– "audio", "text", "effect" ç­‰
       "segments": segments
   }
   draft_config["tracks"].append(track)  # æ·»åŠ ä¸€ä¸ªè½¨é“
   ```

2. **"æ‰¹é‡çš„ç‰‡æ®µ"** - âœ… ä¸€æ¬¡è°ƒç”¨å¯ä»¥åœ¨è¯¥è½¨é“ä¸Šæ·»åŠ å¤šä¸ªç‰‡æ®µ
   ```python
   # è¾“å…¥: image_infos = [img1, img2, img3, ...]
   # å¤„ç†: ä¸ºæ¯ä¸ª info åˆ›å»ºä¸€ä¸ª segment
   for info in image_infos:
       segment = create_segment(info)
       segments.append(segment)
   
   # è¾“å‡º: ä¸€ä¸ªè½¨é“åŒ…å«å¤šä¸ª segments
   track = {"segments": segments}
   ```

3. **"åœ¨æ­¤è½¨é“ä¸Š"** - âœ… æ‰€æœ‰ç‰‡æ®µéƒ½ç»„ç»‡åœ¨åŒä¸€ä¸ªè½¨é“ç»“æ„ä¸­
   ```python
   track = {
       "track_type": "video",
       "segments": [seg1, seg2, seg3, ...]  # æ‰€æœ‰ç‰‡æ®µåœ¨åŒä¸€è½¨é“
   }
   ```

#### 3.3 ä¸ pyJianYingDraft çš„å¯¹åº”æ€§

è™½ç„¶æœ¬é¡¹ç›®çš„ add_* å‡½æ•°ä¸ pyJianYingDraft çš„ `add_segment()` æ¥å£ä¸åŒï¼Œä½†å®ƒä»¬åœ¨**æ¦‚å¿µå±‚é¢**æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼š

| pyJianYingDraft | æœ¬é¡¹ç›® add_* å‡½æ•° | å¯¹åº”å…³ç³» |
|----------------|-----------------|---------|
| Track (è½¨é“) | æ¯æ¬¡è°ƒç”¨åˆ›å»ºçš„ track | âœ… ä¸€ä¸€å¯¹åº” |
| Segment (ç‰‡æ®µ) | track["segments"] ä¸­çš„æ¯ä¸ªå…ƒç´  | âœ… ä¸€ä¸€å¯¹åº” |
| `add_segment(seg)` | æ‰¹é‡æ·»åŠ å¤šä¸ª segments åˆ°ä¸€ä¸ª track | ğŸ”„ ä¸åŒçš„ç²’åº¦ |

**å¯¹åº”å…³ç³»çš„æœ¬è´¨**:
- pyJianYingDraft: `add_segment()` â†’ æ·»åŠ **ä¸€ä¸ªç‰‡æ®µ**ï¼ˆè½¨é“è‡ªåŠ¨ç®¡ç†ï¼‰
- æœ¬é¡¹ç›®: `add_*s()` â†’ æ·»åŠ **ä¸€ä¸ªè½¨é“åŠå…¶åŒ…å«çš„å¤šä¸ªç‰‡æ®µ**ï¼ˆè½¨é“æ˜¾å¼åˆ›å»ºï¼‰

è¿™ç§è®¾è®¡å®é™…ä¸Šæ˜¯å¯¹ pyJianYingDraft æ¥å£çš„**æ›´é«˜å±‚æ¬¡æŠ½è±¡**ï¼š
- pyJianYingDraft çš„ `add_segment()` æ˜¯**ç‰‡æ®µçº§åˆ«**çš„æ“ä½œ
- æœ¬é¡¹ç›®çš„ `add_*s()` æ˜¯**è½¨é“çº§åˆ«**çš„æ“ä½œ

### 4. è®¾è®¡ä¼˜åŠ¿åˆ†æ

#### 4.1 æœ¬é¡¹ç›®è®¾è®¡çš„ä¼˜åŠ¿

1. **æ‰¹é‡æ“ä½œæ•ˆç‡é«˜**
   - ä¸€æ¬¡è°ƒç”¨æ·»åŠ å¤šä¸ªç‰‡æ®µï¼Œå‡å°‘ç½‘ç»œ/IOå¼€é”€
   - ç‰¹åˆ«é€‚åˆ Coze å·¥ä½œæµä¸­çš„æ‰¹é‡å¤„ç†åœºæ™¯

2. **è½¨é“æ§åˆ¶æ›´çµæ´»**
   - ç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶è½¨é“çš„åˆ›å»ºå’Œç»„ç»‡
   - æ”¯æŒåˆ›å»ºå¤šä¸ªå¹³è¡Œè½¨é“ï¼ˆå¦‚å¤šå±‚è§†é¢‘æ•ˆæœï¼‰

3. **ç¬¦åˆ Coze å¹³å°ç‰¹æ€§**
   - Coze å·¥ä½œæµé€šå¸¸æ‰¹é‡ç”Ÿæˆèµ„æº
   - ä¸€æ¬¡æ€§ä¼ é€’å¤šä¸ªèµ„æºæ›´ç¬¦åˆå·¥ä½œæµçš„èŠ‚ç‚¹æ¨¡å¼

4. **JSON æ•°æ®ç»“æ„æ¸…æ™°**
   - ç›´æ¥æ˜ å°„åˆ° Draft Generator Interface çš„æ•°æ®ç»“æ„
   - ä¾¿äºåºåˆ—åŒ–å’Œä¼ è¾“

#### 4.2 é€‚ç”¨åœºæ™¯å¯¹æ¯”

| åœºæ™¯ | pyJianYingDraft | æœ¬é¡¹ç›® add_* |
|------|----------------|-------------|
| **å•ä¸ªç‰‡æ®µæ·»åŠ ** | âœ… ç®€å•ç›´æ¥ | âš ï¸ éœ€è¦åŒ…è£…æˆæ•°ç»„ |
| **æ‰¹é‡ç‰‡æ®µæ·»åŠ ** | âš ï¸ éœ€è¦å¾ªç¯è°ƒç”¨ | âœ… ä¸€æ¬¡æ€§å®Œæˆ |
| **å¤šè½¨é“ç»„ç»‡** | âš ï¸ è‡ªåŠ¨ç®¡ç†ï¼Œæ§åˆ¶æœ‰é™ | âœ… å®Œå…¨æ§åˆ¶ |
| **Coze å·¥ä½œæµ** | âŒ ä¸é€‚åˆï¼ˆéœ€è¦å¤šæ¬¡è°ƒç”¨ï¼‰ | âœ… å®Œç¾åŒ¹é… |

---

## æµ‹è¯•éªŒè¯

### 5.1 ç°æœ‰æµ‹è¯•ç”¨ä¾‹çš„è¯æ˜

ä» `tests/test_add_images.py` ä¸­çš„ `test_add_images_multiple_calls()` æµ‹è¯•ï¼š

```python
def test_add_images_multiple_calls():
    """Test multiple calls to add_images creating separate tracks"""
    
    # ç¬¬ä¸€æ¬¡è°ƒç”¨ - æ·»åŠ 2å¼ å›¾ç‰‡
    result1 = handler(MockArgs(Input(
        draft_id=draft_id, 
        image_infos=[img1, img2]
    )))
    
    # ç¬¬äºŒæ¬¡è°ƒç”¨ - æ·»åŠ 1å¼ å›¾ç‰‡
    result2 = handler(MockArgs(Input(
        draft_id=draft_id, 
        image_infos=[img3]
    )))
    
    # éªŒè¯ï¼šåˆ›å»ºäº†2ä¸ªç‹¬ç«‹çš„è½¨é“
    assert len(config["tracks"]) == 2
    assert config["tracks"][0]["track_type"] == "video"
    assert config["tracks"][1]["track_type"] == "video"
    assert len(config["tracks"][0]["segments"]) == 2  # ç¬¬1ä¸ªè½¨é“æœ‰2ä¸ªç‰‡æ®µ
    assert len(config["tracks"][1]["segments"]) == 1  # ç¬¬2ä¸ªè½¨é“æœ‰1ä¸ªç‰‡æ®µ
```

**æµ‹è¯•ç»“è®º**: âœ… æµ‹è¯•æ˜ç¡®éªŒè¯äº†"æ¯æ¬¡è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°è½¨é“"çš„è¡Œä¸º

### 5.2 æ–‡æ¡£ä¸­çš„è¯´æ˜

ä» `tools/add_effects/README.md`:

```markdown
### è½¨é“ç®¡ç†
- **æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç‰¹æ•ˆè½¨é“**
- åŒä¸€è½¨é“å†…çš„ç‰¹æ•ˆæŒ‰æ—¶é—´é¡ºåºåº”ç”¨
- ä¸åŒè½¨é“çš„ç‰¹æ•ˆå¯ä»¥å åŠ 
```

ä» `tools/add_images/README.md`:

```markdown
å‘ç°æœ‰è‰ç¨¿æ·»åŠ å›¾ç‰‡è½¨é“å’Œå›¾ç‰‡ç‰‡æ®µã€‚**æ¯æ¬¡è°ƒç”¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾ç‰‡è½¨é“**ï¼Œ
åŒ…å«æŒ‡å®šçš„æ‰€æœ‰å›¾ç‰‡ã€‚
```

**æ–‡æ¡£ç»“è®º**: âœ… æ–‡æ¡£æ˜ç¡®è¯´æ˜äº†"æ¯æ¬¡è°ƒç”¨åˆ›å»ºæ–°è½¨é“"çš„è®¾è®¡

---

## å…³é”®æ¦‚å¿µæ¾„æ¸…

### 6.1 "ä¸€ä¸€å¯¹åº”"çš„ç†è§£

**é—®é¢˜**: ä»€ä¹ˆæ˜¯ä¸ pyJianYingDraft çš„"ä¸€ä¸€å¯¹åº”"ï¼Ÿ

**ç­”æ¡ˆ**: ä¸€ä¸€å¯¹åº”æŒ‡çš„æ˜¯**æ¦‚å¿µå’Œæ•°æ®ç»“æ„çš„å¯¹åº”**ï¼Œè€Œé**APIæ¥å£çš„å¯¹åº”**

1. **æ¦‚å¿µå¯¹åº”** - âœ… å®Œå…¨å¯¹åº”
   - pyJianYingDraft æœ‰ Track å’Œ Segment æ¦‚å¿µ
   - æœ¬é¡¹ç›®çš„æ•°æ®ç»“æ„ä¹Ÿæœ‰ track å’Œ segment æ¦‚å¿µ
   - ä¸¤è€…çš„æ•°æ®ç»“æ„å¯ä»¥ç›¸äº’è½¬æ¢

2. **æ•°æ®ç»“æ„å¯¹åº”** - âœ… å®Œå…¨å¯¹åº”
   - pyJianYingDraft: `Track[Seg_type]` åŒ…å«å¤šä¸ª `Segment`
   - æœ¬é¡¹ç›®: `track["segments"]` åŒ…å«å¤šä¸ª `segment` å¯¹è±¡
   - æ•°æ®ç»“æ„å±‚é¢å¯ä»¥æ— æŸè½¬æ¢

3. **API æ¥å£** - ğŸ”„ ä¸åŒçš„æŠ½è±¡å±‚æ¬¡
   - pyJianYingDraft: ç‰‡æ®µçº§åˆ«æ“ä½œ `add_segment(seg)`
   - æœ¬é¡¹ç›®: è½¨é“çº§åˆ«æ“ä½œ `add_*s(infos)`
   - è¿™æ˜¯**æœ‰æ„çš„è®¾è®¡å·®å¼‚**ï¼Œç”¨äºé€‚é… Coze å¹³å°ç‰¹æ€§

### 6.2 ä¸ºä»€ä¹ˆé‡‡ç”¨è½¨é“çº§åˆ«çš„æ¥å£ï¼Ÿ

1. **Coze å¹³å°é™åˆ¶**
   - Coze å·¥ä½œæµèŠ‚ç‚¹é€šå¸¸ä¸€æ¬¡æ€§å¤„ç†æ‰¹é‡æ•°æ®
   - æ— æ³•æ–¹ä¾¿åœ°å®ç°å¾ªç¯è°ƒç”¨ï¼ˆéœ€è¦å¤æ‚çš„æµç¨‹è®¾è®¡ï¼‰
   - æ‰¹é‡æ¥å£æ›´ç¬¦åˆå·¥ä½œæµèŠ‚ç‚¹çš„è¾“å…¥è¾“å‡ºæ¨¡å¼

2. **æ€§èƒ½è€ƒè™‘**
   - æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦åŠ è½½å’Œä¿å­˜ draft_config.json
   - æ‰¹é‡å¤„ç†å‡å°‘äº†æ–‡ä»¶ I/O æ¬¡æ•°
   - åœ¨ /tmp æ–‡ä»¶ç³»ç»Ÿä¸­å°¤å…¶é‡è¦ï¼ˆæœ‰é™çš„ç©ºé—´å’Œæ€§èƒ½ï¼‰

3. **ç”¨æˆ·ä½“éªŒ**
   - Coze å·¥ä½œæµç”¨æˆ·é€šå¸¸ä¸€æ¬¡æ€§ç”Ÿæˆå¤šä¸ªèµ„æº
   - æ‰¹é‡æ¥å£æ›´ç›´è§‚ï¼Œå‡å°‘èŠ‚ç‚¹è¿æ¥å¤æ‚åº¦
   - ç¬¦åˆ"ä¸€æ¬¡è°ƒç”¨å®Œæˆä¸€ä¸ªå®Œæ•´ä»»åŠ¡"çš„å·¥ä½œæµè®¾è®¡ç†å¿µ

4. **ä¸ Draft Generator Interface çš„å¯¹åº”**
   - Draft Generator Interface çš„ `TrackConfig` æœ¬èº«å°±åŒ…å«å¤šä¸ª segments
   - è½¨é“çº§åˆ«çš„æ¥å£ç›´æ¥æ˜ å°„åˆ°æ•°æ®ç»“æ„
   - ä¾¿äºåç»­è‰ç¨¿ç”Ÿæˆå™¨çš„å¤„ç†

---

## è°ƒæŸ¥ç»“è®º

### 7.1 æ ¸å¿ƒé—®é¢˜çš„ç­”æ¡ˆ

**é—®é¢˜**: add_**s å‡½æ•°æ˜¯å¦ä½“ç°äº†"å‘è‰ç¨¿æ·»åŠ ä¸€ä¸ªè½¨é“ï¼Œä»¥åŠåœ¨æ­¤è½¨é“ä¸Šæ·»åŠ çš„æ‰¹é‡çš„ç‰‡æ®µ"çš„è®¾è®¡ï¼Ÿ

**ç­”æ¡ˆ**: âœ… **å®Œå…¨ä½“ç°**

**è¯æ®**:
1. âœ… æ¯æ¬¡è°ƒç”¨ add_* å‡½æ•°éƒ½åˆ›å»ºä¸€ä¸ªæ–°è½¨é“
2. âœ… ä¸€æ¬¡è°ƒç”¨å¯ä»¥æ·»åŠ å¤šä¸ªç‰‡æ®µåˆ°è¯¥è½¨é“
3. âœ… æ‰€æœ‰ç‰‡æ®µéƒ½ç»„ç»‡åœ¨åŒä¸€ä¸ªè½¨é“ç»“æ„ä¸­
4. âœ… æµ‹è¯•ç”¨ä¾‹æ˜ç¡®éªŒè¯äº†è¿™ä¸€è¡Œä¸º
5. âœ… æ–‡æ¡£æ¸…æ¥šè¯´æ˜äº†è¿™ä¸€è®¾è®¡

### 7.2 ä¸ pyJianYingDraft çš„å¯¹åº”æ€§

**å¯¹åº”å±‚æ¬¡**:
- âœ… **æ¦‚å¿µå±‚é¢**: å®Œå…¨å¯¹åº”ï¼ˆTrack â†” track, Segment â†” segmentï¼‰
- âœ… **æ•°æ®ç»“æ„å±‚é¢**: å®Œå…¨å¯¹åº”ï¼ˆå¯æ— æŸè½¬æ¢ï¼‰
- ğŸ”„ **API æ¥å£å±‚é¢**: ä¸åŒçš„æŠ½è±¡å±‚æ¬¡ï¼ˆç‰‡æ®µçº§åˆ« vs è½¨é“çº§åˆ«ï¼‰

**å¯¹åº”å…³ç³»çš„æœ¬è´¨**:
æœ¬é¡¹ç›®çš„ add_* å‡½æ•°æ˜¯å¯¹ pyJianYingDraft æ¥å£çš„**æ›´é«˜å±‚æ¬¡æŠ½è±¡**ï¼Œä»**ç‰‡æ®µçº§åˆ«**æå‡åˆ°**è½¨é“çº§åˆ«**ï¼Œä»¥é€‚é… Coze å¹³å°çš„æ‰¹é‡å¤„ç†ç‰¹æ€§ã€‚

### 7.3 è®¾è®¡åˆç†æ€§è¯„ä¼°

**ä¼˜ç‚¹**:
1. âœ… å®Œç¾é€‚é… Coze å·¥ä½œæµçš„æ‰¹é‡å¤„ç†æ¨¡å¼
2. âœ… æä¾›æ›´é«˜çš„è½¨é“æ§åˆ¶çµæ´»æ€§
3. âœ… å‡å°‘æ–‡ä»¶ I/Oï¼Œæé«˜æ€§èƒ½
4. âœ… æ•°æ®ç»“æ„æ¸…æ™°ï¼Œæ˜“äºåºåˆ—åŒ–å’Œä¼ è¾“

**æƒè¡¡**:
- âš ï¸ å¯¹äºå•ä¸ªç‰‡æ®µæ·»åŠ ï¼Œéœ€è¦åŒ…è£…æˆæ•°ç»„ï¼ˆä½†è¿™åœ¨ Coze å·¥ä½œæµä¸­ä¸æ˜¯é—®é¢˜ï¼‰
- âš ï¸ ç”¨æˆ·éœ€è¦ç†è§£è½¨é“çš„æ¦‚å¿µï¼ˆä½†æ–‡æ¡£å’Œæµ‹è¯•å·²å……åˆ†è¯´æ˜ï¼‰

### 7.4 æœ€ç»ˆç»“è®º

**å½“å‰çš„ add_**s å‡½æ•°æœºåˆ¶å®Œå…¨ç¬¦åˆä¸ pyJianYingDraft ä¸€ä¸€å¯¹åº”çš„è®¾è®¡æ„æƒ³**ã€‚

å…·ä½“è€Œè¨€ï¼š
1. **"å‘è‰ç¨¿æ·»åŠ ä¸€ä¸ªè½¨é“"** - âœ… æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºå¹¶æ·»åŠ ä¸€ä¸ªæ–°è½¨é“
2. **"æ‰¹é‡çš„ç‰‡æ®µ"** - âœ… ä¸€æ¬¡è°ƒç”¨åœ¨è¯¥è½¨é“ä¸Šæ·»åŠ å¤šä¸ªç‰‡æ®µ
3. **"åœ¨æ­¤è½¨é“ä¸Š"** - âœ… æ‰€æœ‰ç‰‡æ®µéƒ½ç»„ç»‡åœ¨åŒä¸€ä¸ªè½¨é“ç»“æ„ä¸­

è¿™ç§è®¾è®¡ä¸ä»…ä½“ç°äº†åŸå§‹æ„æƒ³ï¼Œè¿˜åœ¨æ­¤åŸºç¡€ä¸Šåšäº†**åˆç†çš„æŠ½è±¡æå‡**ï¼Œä»ç‰‡æ®µçº§åˆ«çš„æ“ä½œæå‡åˆ°è½¨é“çº§åˆ«çš„æ“ä½œï¼Œä½¿å…¶æ›´é€‚åˆ Coze å¹³å°çš„å·¥ä½œæµæ¨¡å¼å’Œæ‰¹é‡å¤„ç†éœ€æ±‚ã€‚

---

## é™„å½•

### A. æ‰€æœ‰ add_* å‡½æ•°çš„è½¨é“åˆ›å»ºéªŒè¯

| å·¥å…· | è½¨é“ç±»å‹ | åˆ›å»ºå‡½æ•° | éªŒè¯çŠ¶æ€ |
|------|---------|---------|---------|
| add_images | video | create_image_track_with_segments | âœ… å·²éªŒè¯ |
| add_videos | video | create_video_track_with_segments | âœ… å·²éªŒè¯ |
| add_audios | audio | create_audio_track_with_segments | âœ… å·²éªŒè¯ |
| add_captions | text | create_text_track_with_segments | âœ… å·²éªŒè¯ |
| add_effects | effect | create_effect_track_with_segments | âœ… å·²éªŒè¯ |

æ‰€æœ‰å·¥å…·éƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ï¼š
```python
segment_ids, segment_infos, track = create_*_track_with_segments(infos)
draft_config["tracks"].append(track)  # æ·»åŠ æ–°è½¨é“
```

### B. ç›¸å…³ä»£ç ä½ç½®

- **add_images**: `tools/add_images/handler.py`, line 218-305
- **add_videos**: `tools/add_videos/handler.py`, line 225-312
- **add_audios**: `tools/add_audios/handler.py`, line 202-270
- **add_captions**: `tools/add_captions/handler.py`, ç±»ä¼¼æ¨¡å¼
- **add_effects**: `tools/add_effects/handler.py`, line 180-236

### C. ç›¸å…³æ–‡æ¡£

- **Draft Generator Interface**: `data_structures/draft_generator_interface/README.md`
- **è½¨é“æ®µé…ç½®è¯´æ˜**: åŒ…å« VideoSegmentConfig, AudioSegmentConfig ç­‰ç±»çš„å®šä¹‰
- **å„å·¥å…·çš„ README**: éƒ½æ˜ç¡®è¯´æ˜äº†"æ¯æ¬¡è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°è½¨é“"çš„è¡Œä¸º

---

**è°ƒæŸ¥å®Œæˆæ—¥æœŸ**: 2024å¹´  
**è°ƒæŸ¥äºº**: GitHub Copilot  
**é—®é¢˜çŠ¶æ€**: å·²è§£å†³ âœ…
