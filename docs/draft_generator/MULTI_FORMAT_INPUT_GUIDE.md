# 多格式输入支持指南

## 概述

经过增强后，输入框现在支持多种格式的内容，不仅限于包含 `output` 字段的 Coze 输出格式。以下是所有支持的格式：

## 支持的输入格式

### 1. Coze 输出格式（原有格式）

包含 `output` 字段的 JSON 格式，其中 `output` 字段本身是一个 JSON 字符串。

```json
{
  "output": "{\"format_version\":\"1.0\",\"export_type\":\"single_draft\",\"draft_count\":1,\"drafts\":[...]}"
}
```

### 2. 标准剪映草稿格式 ⭐ **新支持**

直接包含 `drafts` 数组的标准格式，就像 `sample.json` 中的格式：

```json
{
  "format_version": "1.0",
  "export_type": "single_draft",
  "draft_count": 1,
  "drafts": [
    {
      "draft_id": "68c1a119-02b9-401f-9bac-fda50e86727d",
      "project": {
        "name": "Coze剪映项目",
        "width": 1440,
        "height": 1080,
        "fps": 30
      },
      "tracks": [...]
    }
  ]
}
```

### 3. 单个草稿对象格式 ⭐ **新支持**

直接是一个草稿对象，包含 `tracks` 等字段：

```json
{
  "draft_id": "test-draft",
  "project": {
    "name": "测试项目",
    "width": 1920,
    "height": 1080,
    "fps": 30
  },
  "tracks": [
    {
      "track_type": "text",
      "segments": [...]
    }
  ]
}
```

### 4. 自定义格式智能推断 ⭐ **新支持**

对于包含草稿列表但字段名不标准的格式，程序会智能推断：

```json
{
  "video_projects": [
    {
      "project": {...},
      "tracks": [...]
    }
  ]
}
```

## 使用方法

### 直接复制粘贴

1. 从任何来源复制 JSON 内容
2. 直接粘贴到输入框中
3. 点击"生成草稿"

### 从文件读取

你也可以将 JSON 内容保存为文件，然后通过程序读取。

## 格式检测原理

程序会按以下顺序智能检测输入格式：

1. **检查 `output` 字段** → Coze 输出格式
2. **检查 `drafts` 数组** → 标准剪映草稿格式
3. **检查 `tracks` 字段** → 单个草稿对象格式
4. **智能推断其他可能的草稿列表** → 自定义格式

## 测试验证

### ✅ 已验证的格式

- [x] Coze 输出格式（原有）
- [x] 标准剪映草稿格式（如 sample.json）
- [x] 单个草稿对象格式
- [x] 自定义格式智能推断
- [x] 无效格式正确拒绝

### 测试结果

使用 `sample.json` 进行的实际测试：

- ✅ 格式识别：成功检测到标准剪映草稿格式
- ✅ 数据解析：1 个草稿，3 个轨道，15 个片段
- ✅ 素材下载：10 个文件，总计 3.92MB
- ✅ 草稿生成：成功创建剪映项目文件

## 错误处理

如果输入的格式无法识别，程序会提供清晰的错误信息：

```
无法识别的输入格式。
支持的格式:
1. Coze输出格式 (包含'output'字段)
2. 标准剪映草稿格式 (包含'drafts'数组)
3. 单个草稿对象 (包含'tracks'字段)
当前输入包含字段: [字段列表]
```

## 优势

1. **兼容性强**：支持多种常见的剪映草稿 JSON 格式
2. **智能检测**：自动识别格式，无需手动指定
3. **向后兼容**：原有的 Coze 输出格式仍然完全支持
4. **扩展性好**：可以轻松添加新的格式支持

## 示例用法

现在你可以直接：

- 从剪映导出的 JSON 文件复制内容到输入框
- 从其他工具生成的草稿 JSON 复制内容到输入框
- 使用任何符合基本结构的自定义 JSON 格式

程序会自动识别并正确处理！
