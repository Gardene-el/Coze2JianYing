# 脚本执行标签页 - UI 布局说明

## 整体布局

脚本执行标签页采用垂直布局，从上到下分为以下几个区域：

```
┌─────────────────────────────────────────────────────────────┐
│ 🎬 脚本执行 标签页                                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ ┌─ 脚本文件 ────────────────────────────────────────────┐  │
│ │ 脚本文件: [未加载                           ] [加载文件...]│
│ └───────────────────────────────────────────────────────┘  │
│                                                             │
│ 脚本内容:                                                   │
│ ┌─────────────────────────────────────────────────────┐    │
│ │                                                     │    │
│ │  # API 调用: create_draft                          │    │
│ │  req = CreateDraftRequest(                         │    │
│ │      draft_name="demo",                            │    │
│ │      width=1920,                                   │    │
│ │      height=1080,                                  │    │
│ │      fps=30                                        │    │
│ │  )                                                 │    │
│ │  resp = await create_draft(req)                    │    │
│ │  draft_id = resp.draft_id                          │    │
│ │                                                     │    │
│ │  # API 调用: add_track                             │    │
│ │  track_req = AddTrackRequest(                      │    │
│ │      track_type="audio"                            │    │
│ │  )                                                 │    │
│ │  ...                                               │    │
│ │                                                     │    │
│ └─────────────────────────────────────────────────────┘    │
│                                                             │
│ [执行脚本]  [验证脚本]  [清空]                              │
│                                                             │
│ 就绪                                                        │
└─────────────────────────────────────────────────────────────┘
```

## 区域说明

### 1. 脚本文件区域（顶部）
- **标签框**：使用 `LabelFrame`，标题为"脚本文件"
- **文件路径显示**：只读文本框，显示当前加载的文件路径
- **加载文件按钮**：打开文件选择对话框

### 2. 脚本内容区域（中部主体）
- **标签**："脚本内容:"
- **文本编辑器**：可滚动的多行文本框
  - 高度：15 行
  - 字体：Consolas 9pt（等宽字体，便于阅读代码）
  - 支持换行
  - 支持滚动条

### 3. 按钮区域（底部）
三个按钮水平排列：
- **执行脚本**：主要操作按钮，执行脚本生成草稿
- **验证脚本**：检查脚本语法是否正确
- **清空**：清空脚本内容

### 4. 状态栏（最底部）
- 显示当前操作状态
- 状态示例：
  - "就绪"（初始状态）
  - "已加载: 测试用的脚本"（加载文件后）
  - "验证通过"（验证成功后）
  - "正在执行脚本..."（执行中）
  - "脚本执行成功"（执行完成）
  - "脚本执行失败"（执行失败）

## 交互流程

### 流程一：加载文件并执行

```
用户点击 [加载文件...]
    ↓
文件选择对话框
    ↓
选择文件（如: 测试用的脚本）
    ↓
文件内容显示在文本框
    ↓
状态栏更新: "已加载: 测试用的脚本"
    ↓
用户点击 [验证脚本] (可选)
    ↓
显示验证结果对话框
    ↓
用户点击 [执行脚本]
    ↓
状态栏更新: "正在执行脚本..."
    ↓
后台线程执行脚本
    ↓
执行完成，显示成功对话框
    ↓
状态栏更新: "脚本执行成功"
```

### 流程二：手动粘贴并执行

```
用户在文本框中粘贴脚本
    ↓
用户点击 [验证脚本] (可选)
    ↓
显示验证结果对话框
    ↓
用户点击 [执行脚本]
    ↓
状态栏更新: "正在执行脚本..."
    ↓
后台线程执行脚本
    ↓
执行完成，显示成功对话框
    ↓
状态栏更新: "脚本执行成功"
```

## 对话框

### 文件选择对话框
```
┌─ 选择脚本文件 ──────────────────────┐
│                                     │
│  查找范围: [▼ 我的电脑        ]    │
│                                     │
│  文件列表:                          │
│  📄 测试用的脚本                    │
│  📄 script.py                       │
│  📄 draft_script.txt                │
│                                     │
│  文件名: [                    ]     │
│  文件类型: [Python脚本 (*.py) ▼]   │
│                                     │
│              [打开]  [取消]         │
└─────────────────────────────────────┘
```

### 验证成功对话框
```
┌─ 验证成功 ─────────────────┐
│                            │
│  ✓  脚本语法验证通过！     │
│                            │
│           [确定]           │
└────────────────────────────┘
```

### 验证失败对话框
```
┌─ 语法错误 ─────────────────┐
│                            │
│  脚本语法错误:             │
│  行 42: 'await' outside    │
│  function                  │
│                            │
│           [确定]           │
└────────────────────────────┘
```

### 执行成功对话框
```
┌─ 成功 ─────────────────────┐
│                            │
│  脚本执行成功！            │
│                            │
│  草稿已生成到剪映草稿      │
│  文件夹。                  │
│                            │
│           [确定]           │
└────────────────────────────┘
```

### 执行失败对话框
```
┌─ 执行失败 ─────────────────────────┐
│                                    │
│  脚本执行失败:                     │
│                                    │
│  HTTPException: 草稿 xxx 不存在    │
│                                    │
│  详细信息请查看日志。              │
│                                    │
│              [确定]                │
└────────────────────────────────────┘
```

## 与其他标签页的对比

### 相似之处
- 与"手动草稿生成"标签页布局相似
- 都有大型文本输入区域
- 都有执行按钮和状态反馈
- 都支持后台线程执行

### 差异之处
- **输入内容**：脚本 vs JSON
- **文件加载**：有专门的文件加载区域
- **验证功能**：独立的验证按钮
- **执行方式**：exec() 执行 Python 代码 vs 解析 JSON

## 响应式设计

### 窗口大小调整
- **水平方向**：文本框和按钮随窗口宽度调整
- **垂直方向**：文本框高度随窗口高度调整
- **最小尺寸**：确保所有控件可见

### 状态反馈
- **执行中**：禁用"执行脚本"按钮，防止重复点击
- **执行完成**：重新启用按钮，更新状态栏

## 键盘快捷键（未来可能添加）
- `Ctrl+O`：打开文件
- `Ctrl+V`：粘贴脚本
- `Ctrl+E`：执行脚本
- `Ctrl+Shift+V`：验证脚本
- `Ctrl+L`：清空内容

## 实现细节

### 字体选择
- 使用 **Consolas** 等宽字体
- 便于阅读 Python 代码
- 清晰显示缩进和对齐

### 颜色方案
- 使用系统默认主题
- 状态栏使用 SUNKEN 样式
- 错误消息使用红色（在对话框中）

### 性能优化
- 后台线程执行，不阻塞 UI
- 使用 `frame.after()` 确保线程安全
- 大文件加载时显示加载状态

## 可访问性
- 所有按钮都有清晰的文本标签
- 状态栏提供实时反馈
- 错误消息详细且易于理解
- 支持键盘导航（Tab 键切换）
