# 嵌入式日志面板 - 界面说明

## 新功能概览

根据用户反馈，日志查看器现已内嵌到主界面中，无需额外打开窗口。

## 界面布局

### 完整界面（日志面板显示）

```
┌───────────────────────────────────────────────────────────────┐
│  Coze剪映草稿生成器                                    [_][□][×] │
├───────────────────────────────────────────────────────────────┤
│  文件(F)  查看(V)  帮助(H)                                     │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─ 输出设置 ─────────────────────────────────────────────┐  │
│  │ 剪映草稿文件夹: [未选择(将使用默认路径)]               │  │
│  │                 [选择文件夹...] [自动检测]             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                               │
│  输入内容:                                                     │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ {                                                        │ │
│  │   "drafts": [...],                                       │ │
│  │   ...                                                    │ │
│  │ }                                                        │ │
│  │                                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                               │
│  [生成草稿]  [清空]  [隐藏日志]                              │
│                                                               │
│  状态：就绪                                                   │
│                                                               │
├═══════════════════════════════════════════════════════════════┤ ← 可拖拽调整
│                                                               │
│  ┌─ 日志 ──────────────────────────────────────────────────┐ │
│  │ [清空]  [保存]  [☑ 自动滚动]                           │ │
│  │ ┌────────────────────────────────────────────────────┐ │ │
│  │ │ 2025-10-28 08:22:34 - INFO - 应用程序启动          │ │ │
│  │ │ 2025-10-28 08:22:35 - INFO - 开始生成草稿          │ │ │
│  │ │ 2025-10-28 08:22:36 - INFO - 步骤1: 解析JSON      │ │ │
│  │ │ 2025-10-28 08:22:37 - WARNING - 文件较大...       │ │ │
│  │ │ 2025-10-28 08:22:38 - INFO - 步骤2: 下载素材      │ │ │
│  │ │ ...                                                │ │ │
│  │ └────────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### 日志面板隐藏状态

```
┌───────────────────────────────────────────────────────────────┐
│  Coze剪映草稿生成器                                    [_][□][×] │
├───────────────────────────────────────────────────────────────┤
│  文件(F)  查看(V)  帮助(H)                                     │
├───────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌─ 输出设置 ─────────────────────────────────────────────┐  │
│  │ 剪映草稿文件夹: [未选择(将使用默认路径)]               │  │
│  │                 [选择文件夹...] [自动检测]             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                               │
│  输入内容:                                                     │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ {                                                        │ │
│  │   "drafts": [...],                                       │ │
│  │   ...                                                    │ │
│  │ }                                                        │ │
│  │                                                          │ │
│  │                                                          │ │
│  │                                                          │ │
│  │                                                          │ │
│  │                                                          │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                               │
│  [生成草稿]  [清空]  [显示日志]  ← 按钮文字变化              │
│                                                               │
│  状态：就绪                                                   │
│                                                               │
└───────────────────────────────────────────────────────────────┘
```

## 功能特性

### 1. 嵌入式日志面板

**位置**: 主窗口下部
**特点**:
- ✅ 无需额外打开窗口
- ✅ 实时显示日志信息
- ✅ 彩色区分日志级别
  - INFO: 黑色
  - WARNING: 橙色
  - ERROR: 红色
  - DEBUG: 灰色

### 2. 可调整布局

**操作**: 拖拽中间分隔线
**效果**:
- 向上拖：日志面板变大，输入区域变小
- 向下拖：输入区域变大，日志面板变小
- 自由调整到最舒适的比例

### 3. 切换显示/隐藏

**方式一**: 点击 [隐藏日志] / [显示日志] 按钮
**方式二**: 菜单 → 查看 → 切换日志面板

**效果**:
- 隐藏后：输入区域占据全部空间
- 显示后：恢复日志面板显示

### 4. 日志工具栏

在日志面板顶部提供：

| 按钮/选项 | 功能 |
|----------|------|
| [清空] | 清除所有日志内容 |
| [保存] | 将日志保存到文件 |
| [☑ 自动滚动] | 自动滚动到最新日志 |

### 5. 自动行为

**生成草稿时**:
- 如果日志面板已隐藏，自动显示
- 实时显示生成进度
- 保持主窗口响应

**日志更新**:
- 立即显示新日志行
- 自动滚动到底部（可选）
- 强制刷新显示，无延迟

### 6. 保留独立窗口选项

通过菜单访问：**查看 → 日志窗口（独立）**

**功能**:
- 打开传统的独立日志窗口
- 可移动到其他显示器
- 与嵌入式面板同步显示
- 保留原有的所有功能

## 使用场景

### 场景 1: 日常使用

```
用户操作:
1. 打开应用，日志面板默认显示在下方
2. 输入 JSON 内容
3. 点击 [生成草稿]
4. 实时查看下方日志面板中的进度
5. 无需切换窗口，一切尽在眼前
```

### 场景 2: 需要更多输入空间

```
用户操作:
1. 点击 [隐藏日志] 按钮
2. 输入区域扩大到整个窗口
3. 粘贴大量 JSON 内容
4. 需要时点击 [显示日志] 恢复
```

### 场景 3: 调试问题

```
用户操作:
1. 向上拖拽分隔线，扩大日志面板
2. 生成草稿时观察详细日志
3. 发现错误时，日志已完整显示
4. 点击 [保存] 按钮保存日志用于报告
```

### 场景 4: 多显示器工作

```
用户操作:
1. 菜单 → 查看 → 日志窗口（独立）
2. 拖动独立日志窗口到第二个显示器
3. 主窗口保持在主显示器
4. 两个窗口同步显示日志
```

## 快捷操作

| 操作 | 方式 |
|-----|------|
| 切换日志面板 | 点击按钮或菜单 |
| 调整面板大小 | 拖拽中间分隔线 |
| 清空日志 | 点击日志工具栏 [清空] |
| 保存日志 | 点击日志工具栏 [保存] |
| 打开独立窗口 | 菜单 → 查看 → 日志窗口（独立） |

## 优势对比

| 特性 | 旧版本（独立窗口） | 新版本（嵌入式） |
|-----|------------------|----------------|
| 查看日志 | 需要打开额外窗口 ✗ | 直接内嵌显示 ✓ |
| 窗口管理 | 需要管理两个窗口 ✗ | 单一窗口 ✓ |
| 切换查看 | 需要切换焦点 ✗ | 上下一览无余 ✓ |
| 空间利用 | 固定分配 ✗ | 可自由调整 ✓ |
| 多显示器 | 支持 ✓ | 同样支持 ✓ |

## 技术实现

### PanedWindow 分隔

```python
# 创建垂直分隔的 PanedWindow
self.paned_window = ttk.PanedWindow(self.root, orient=tk.VERTICAL)

# 上部：主要工作区（权重3）
self.paned_window.add(top_frame, weight=3)

# 下部：日志面板（权重1）
self.paned_window.add(self.log_frame, weight=1)
```

**说明**: 权重3:1表示初始时上部占3/4，下部占1/4，但用户可自由调整。

### 切换显示/隐藏

```python
def _toggle_log_panel(self):
    if self.log_panel_visible:
        # 隐藏：从 PanedWindow 移除
        self.paned_window.remove(self.log_frame)
        self.toggle_log_btn.config(text="显示日志")
    else:
        # 显示：添加回 PanedWindow
        self.paned_window.add(self.log_frame, weight=1)
        self.toggle_log_btn.config(text="隐藏日志")
    self.log_panel_visible = not self.log_panel_visible
```

### 双向日志更新

```python
def _on_log_message(self, message: str):
    # 1. 更新嵌入式日志面板
    self._append_to_embedded_log(message)
    
    # 2. 如果独立窗口已打开，同时更新
    if self.log_window and self.log_window.is_open():
        self.log_window.append_log(message)
```

## 向后兼容

✅ **完全兼容**: 所有原有功能保持不变
- 独立日志窗口仍可通过菜单打开
- 日志文件记录功能不受影响
- 所有现有的快捷键和操作保持一致

## 反馈与建议

如果您有任何建议或发现问题，请在 GitHub 上提交 Issue！

---

**享受全新的嵌入式日志体验！** 🎉
